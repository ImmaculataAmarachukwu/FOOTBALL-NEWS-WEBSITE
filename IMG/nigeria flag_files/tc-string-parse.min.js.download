"use strict";!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?module.exports=n():e.TCStringParse=n()}("undefined"==typeof self?this:self,(function(){function e(e){return parseInt(e,2)||0}var n=function(n){return 100*e(n)},r=function(n){for(var r="A".charCodeAt(),t=n.match(/.{6}/g)||[],s="",o=0,i=t.length;o<i;o+=1){var u=e(t[o])+r;s+=String.fromCharCode(u)}return s},t=function(e){return Boolean(Number(e))},s=function(e){for(var n=e.split(""),r={},s=0,o=n.length;s<o;s+=1)t(n[s])&&(r[s+1]=!0);return r};return function(o){function i(e,n,r,o){function i(){if(o.pubRestrictionEntry&&o.rangeEntry)for(var n in o.rangeEntry)Object.prototype.hasOwnProperty.call(o.rangeEntry,n)&&(o.pubRestrictionEntry[n]=(o.pubRestrictionEntry[n]||[]).concat(o.rangeEntry[n]));o.numPubRestrictions&&(--o.numPubRestrictions,e.push({key:"purposeId",size:6},{key:"restrictionType",size:2},{key:"numEntries",size:12}))}function u(){o.numEntries?(--o.numEntries,e.push({key:"isRange",size:1,decoder:t},{key:"startVendorId",size:16})):i()}function c(){return!o.purposeId||[{purpose:o.purposeId,isAllowed:0!==o.restrictionType,isConsentRequired:1===o.restrictionType,isLegitimateInterestRequired:2===o.restrictionType}]}if("isRangeEncoding"===n.key)e.push(r?{key:"numEntries",size:12}:{key:"bitField",size:o.maxVendorId,decoder:s});else if("numEntries"===n.key)o.rangeEntry={},u();else if("isRange"===n.key)r&&e.push({key:"endVendorId",size:16});else if("startVendorId"===n.key)o.isRange||(o.rangeEntry[r]=c(),u());else if("endVendorId"===n.key){for(var d=o.startVendorId;d<=o.endVendorId;d+=1)o.rangeEntry[d]=c();u()}else"numCustomPurposes"===n.key?e.push({key:"customPurposeConsents",size:o.numCustomPurposes,decoder:s},{key:"customPurposeLegitimateInterests",size:o.numCustomPurposes,decoder:s}):"numPubRestrictions"===n.key&&(o.pubRestrictionEntry={},i())}function u(e){return e.pubRestrictionEntry||e.rangeEntry||e.bitField||e}function c(n,r){var t=r.slice(a,a+n.size);return a+=n.size,(n.decoder||e)(t)}function d(e,n){for(var r={},t=0;t<e.queue.length;t+=1){var s=e.queue[t],o=function(e,n){if(!e.queue)return c(e,n);for(var r={},t=0;t<e.queue.length;t+=1){var s=e.queue[t],o=c(s,n);s.key&&(r[s.key]=o),i(e.queue,s,o,r)}return u(r)}(s,n);s.key&&(r[s.key]=o),i(e.queue,s,o,r)}return u(r)}var a=0;return function(){for(var i=function(n){if("string"!=typeof n)throw new Error("Invalid transparency and consent string specified");for(var r=n.split("."),t=[],s=0,o=r.length;s<o;s+=1)t.push(function(e){for(var n="",r=0,t=e.length;r<t;r+=1){var s=e.charCodeAt(r).toString(2);n+="00000000".slice(0,8-s.length)+s}return n}(function(e){if("function"==typeof atob){var n=e.replace(/_/g,"/").replace(/-/g,"+");try{return atob(n)}catch(e){throw new Error("Unable to decode transparency and consent string")}}if("function"==typeof Buffer)return Buffer.from(e,"base64").toString("binary");throw new Error("Unable to detect base64 decoder")}(r[s])));var i=e(t[0].slice(0,6));if(2!==i)throw new Error("Unsupported transparency and consent string version “"+i+"”");return t}(o),u=function(o){for(var i=[{key:"purposeConsents",size:24,decoder:s},{key:"purposeLegitimateInterests",size:24,decoder:s}],u=[{key:"maxVendorId",size:16},{key:"isRangeEncoding",size:1,decoder:t}],c=[{key:"version",size:6},{key:"created",size:36,decoder:n},{key:"lastUpdated",size:36,decoder:n},{key:"cmpId",size:12},{key:"cmpVersion",size:12},{key:"consentScreen",size:6},{key:"consentLanguage",size:12,decoder:r},{key:"vendorListVersion",size:12},{key:"policyVersion",size:6},{key:"isServiceSpecified",size:1,decoder:t},{key:"useNonStandardStacks",size:1,decoder:t},{key:"specialFeatureOptins",size:12,decoder:s}].concat(i).concat({key:"purposeOneTreatment",size:1,decoder:t},{key:"publisherCountryCode",size:12,decoder:r},{key:"vendorConsents",queue:[{key:"maxVendorId",size:16},{key:"isRangeEncoding",size:1,decoder:t}]},{key:"vendorLegitimateInterests",queue:u},{key:"publisherRestrictions",queue:[{key:"numPubRestrictions",size:12}]}),d=[{size:3}],a=[].concat(d).concat(u),y=[].concat(d).concat(u),p=[].concat(d).concat(i).concat({key:"numCustomPurposes",size:6}),f=[{key:"core",queue:c}],k=1;k<o.length;k+=1){var l=e(o[k].slice(0,3));1===l?f.push({key:"disclosedVendors",queue:a}):2===l?f.push({key:"allowedVendors",queue:y}):3===l&&f.push({key:"publisherTC",queue:p})}return f}(i),c={},y=0;y<u.length;y+=1){var p=u[y],f=d(p,i[y]);p.key&&(c[p.key]=f),a=0}return c}()}}));